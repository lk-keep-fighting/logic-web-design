{"type":"page","body":[{"type":"form","id":"javaForm","name":"form1","title":"节点配置","body":[{"type":"input-text","id":"u:30db4470577d","label":"名称","name":"name"},{"type":"select","id":"u:47dddf5a2395","label":"类路径","name":"url","multiple":false,"searchable":true,"source":{"url":"${runtime?`papi/${runtime}/api/ide/asset/v1/java/classes`:'/api/ide/asset/v1/java/classes'}","method":"get","requestAdaptor":"","adaptor":"return {\n    status: 0,\n    data: {\n        options: payload.data\n    }\n}","messages":{}},"labelField":"value","valueField":"value","onEvent":{"change":{"weight":0,"actions":[{"componentId":"u:c6c9ec0a41f6","actionType":"reload","groupType":"component"}]}}},{"type":"select","label":{"type":"wrapper","id":"u:8cc4049e012f","body":[{"type":"tpl","id":"u:58107c87fedb","tpl":"方法名","onEvent":{"click":{"actions":[{"actionType":"copy","args":{"copyFormat":"text/plain","content":"${method}"}}]}},"className":"mr-2"},{"type":"icon","id":"u:e107795c10cc","icon":"fa-sharp fa-thin fa-copy","className":"text-xl","onEvent":{"click":{"actions":[{"actionType":"custom","ignoreError":false,"script":"/* 自定义JS使用说明：\n  * 1.动作执行函数doAction，可以执行所有类型的动作\n  * 2.通过上下文对象context可以获取当前组件实例，例如context.props可以获取该组件相关属性\n  * 3.事件对象event，在doAction之后执行event.stopPropagation();可以阻止后续动作执行\n*/\nconst msg = context.props.data.method;\nconsole.log('context')\nconsole.log(context)\ndoAction({\n  actionType: 'copy',\n  args: {\n    content: msg.split(\"(\")[0]\n  }\n});\n"}]}}}],"size":"xs","style":{"position":"static","display":"inline","overflowX":"visible","margin":"0","textAlign":"left"},"isFixedHeight":false,"isFixedWidth":false,"onEvent":{"click":{"actions":[{"actionType":"copy","args":{"copyFormat":"text/plain","content":"${method}"}}]}}},"name":"method","id":"u:c6c9ec0a41f6","multiple":false,"searchable":true,"source":{"url":"${runtime?`/api/ide/papi/${runtime}/api/ide/asset/v1/java/class/${url}/methods`:`/api/ide/asset/v1/java/class/${url}/methods`}","method":"get","requestAdaptor":"","adaptor":"let methods = payload.data;\nif (methods && methods.length > 0) {\n    methods.forEach(m => {\n        let paramsStr = '';\n        m.parameters.forEach(p => {\n            paramsStr = paramsStr + `,${p.name}`;\n        })\n        if (paramsStr.length > 1) {\n            m.nameWithParam = `${m.name}(${paramsStr.substring(1)})`\n        } else {\n            m.nameWithParam = `${m.name}()`\n        }\n    });\n}\nreturn {\n    status: 0,\n    data: {\n        value: api.context.method,\n        options: methods\n    }\n}","messages":{},"silent":true,"sendOn":"this.url?.length>0"},"labelField":"nameWithParam","valueField":"nameWithParam","removable":false,"editable":false,"clearable":true,"onEvent":{"change":{"weight":0,"actions":[{"ignoreError":false,"actionType":"custom","script":"/* 自定义JS使用说明：\n  * 1.动作执行函数doAction，可以执行所有类型的动作\n  * 2.通过上下文对象context可以获取当前组件实例，例如context.props可以获取该组件相关属性\n  * 3.事件对象event，在doAction之后执行event.stopPropagation();可以阻止后续动作执行\n*/\nlet body = {};\nlet returnBody = {};\nlet params = []\nlet returnType = {}\nlet sourceCode = ''\nlet gitInfo = ''\nconsole.log('method:valuechange:event.data.selectedItems')\nconsole.log(event.data.selectedItems)\nif (event.data.selectedItems && event.data.selectedItems.parameters) {\n  console.log('method:event.data.selectedItems')\n  console.log(event.data.selectedItems)\n  params = event.data.selectedItems.parameters;\n  returnType = event.data.selectedItems.returnType;\n  sourceCode = event.data.selectedItems.codeInfo.sourceCode;\n  gitInfo = event.data.selectedItems.codeInfo.gitInfo?.memo;\n  event.data.selectedItems.parameters.forEach(p => {\n    let anno = p.typeAnnotation;\n    let parValue = null;\n    if (anno.typeKind == 'reference' && anno.properties && anno.properties.length > 0) {\n      parValue = {};\n      anno.properties.forEach(prop => {\n        parValue[prop.name] = JSON.parse(prop.defaultValue);\n      })\n    }\n    body[p.name] = parValue;\n  })\n  let retAnno = returnType.typeAnnotation;\n  let retValue = {};\n  if (retAnno.typeKind == 'reference' && retAnno.properties && retAnno.properties.length > 0) {\n    retAnno.properties.forEach(prop => {\n      if (retAnno.typeKind == 'reference' && retAnno.properties && retAnno.properties.length > 0) {\n        retValue[prop.name] = JSON.parse(prop.defaultValue);\n      } retValue[prop.name] = null;\n    })\n  } else retValue = null;\n  returnBody = retValue;\n}\ndoAction({\n  actionType: 'setValue',\n  componentId: 'item_body',\n  args: {\n    value: `return ` + JSON.stringify(body, null, 2)\n  }\n});\ndoAction({\n  actionType: 'setValue',\n  componentId: 'item_params',\n  args: {\n    value: params\n  }\n});\ndoAction({\n  actionType: 'setValue',\n  componentId: 'bodyForm',\n  args: {\n    value: params\n  }\n});\ndoAction({\n  actionType: 'setValue',\n  componentId: 'item_returnType',\n  args: {\n    value: returnType\n  }\n});\ndoAction({\n  actionType: 'setValue',\n  componentId: 'sourceCode',\n  args: {\n    value: sourceCode\n  }\n});\ndoAction({\n  actionType: 'setValue',\n  componentId: 'gitInfo',\n  args: {\n    value: gitInfo\n  }\n});\ndoAction({\n  actionType: 'setValue',\n  componentId: 'item_return',\n  args: {\n    value: JSON.stringify(returnBody, null, 2)\n  }\n});\n\ndoAction({\n  actionType: 'setValue',\n  componentId: 'javaForm',\n  args: {\n    value: {\n      \"item_returnBody\": JSON.stringify(returnBody, null, 2)\n    }\n  }\n});\n\n"}]}},"showInvalidMatch":false,"selectFirst":false,"value":""},{"type":"switch","label":"","option":"通过表单配置入参","name":"bodyByForm","falseValue":false,"trueValue":true,"id":"u:923418b6f63d","value":false,"onEvent":{"change":{"weight":0,"actions":[{"ignoreError":false,"actionType":"custom","script":"// /* 自定义JS使用说明：\n//   * 1.动作执行函数doAction，可以执行所有类型的动作\n//   * 2.通过上下文对象context可以获取当前组件实例，例如context.props可以获取该组件相关属性\n//   * 3.事件对象event，在doAction之后执行event.stopPropagation();可以阻止后续动作执行\n// */\n// let body = {};\n// let params = context.props.data.params;\n// let bodyByForm = context.props.data.params;\n// if (params) {\n//   params.forEach(p => {\n//     let anno = p.typeAnnotation;\n//     let parValue = null;\n//     if (anno.typeKind == 'reference' && anno.properties && anno.properties.length > 0) {\n//       parValue = {};\n//       anno.properties.forEach(prop => {\n//         parValue[prop.name] = JSON.parse(prop.defaultValue);\n//       })\n//     }\n//     body[p.name] = parValue;\n//   })\n// }\n// if (bodyByForm) {\n\n// }\n// else {\n//   doAction({\n//     actionType: 'setValue',\n//     componentId: 'item_body',\n//     args: {\n//       value: `return ` + JSON.stringify(body, null, 2)\n//     }\n//   });\n// }\n\n\n\n\n"}]}}},{"type":"editor","id":"item_body","label":"请求参数","name":"body","language":"javascript","value":"","description":"js代码块，return {}","hiddenOn":"this.bodyByForm==true"},{"type":"editor","label":"方法源码","name":"sourceCode","id":"sourceCode","language":"java","description":"本地调试时可自动解析"},{"type":"textarea","label":"git信息","name":"gitInfo","id":"gitInfo","minRows":3,"maxRows":20},{"type":"input-table","name":"params","label":"参数表单","columns":[{"label":"名称","name":"name","quickEdit":false,"id":"u:8b24ab7bb8cd","placeholder":"-"},{"label":"默认值","name":"defaultValue","quickEdit":{"type":"wrapper","mode":"popOver","id":"u:e2d995706873","wrap":false,"body":[{"type":"editor","name":"defaultValue","id":"u:98d288aea3a9","label":"代码编辑器"}],"saveImmediately":true},"id":"u:6dee33934f41","placeholder":"-"}],"addable":false,"footerAddBtn":{"label":"新增","icon":"fa fa-plus"},"strictMode":true,"id":"bodyForm","minLength":0,"hiddenOn":"this.bodyByForm==false","editable":false,"onEvent":{}},{"type":"button","label":"返回参数示例","onEvent":{"click":{"actions":[{"ignoreError":false,"actionType":"custom","script":"/* 自定义JS使用说明：\n  * 1.动作执行函数doAction，可以执行所有类型的动作\n  * 2.通过上下文对象context可以获取当前组件实例，例如context.props可以获取该组件相关属性\n  * 3.事件对象event，在doAction之后执行event.stopPropagation();可以阻止后续动作执行\n*/\nlet returnBody = {};\nlet returnType = context.props.data?.returnType\nconsole.log('context.props.data')\nconsole.log(context.props.data)\nlet retAnno = returnType.typeAnnotation;\nlet retValue = {};\nif (retAnno.typeKind == 'reference' && retAnno.properties && retAnno.properties.length > 0) {\n  retAnno.properties.forEach(prop => {\n    if (retAnno.typeKind == 'reference' && retAnno.properties && retAnno.properties.length > 0) {\n      retValue[prop.name] = JSON.parse(prop.defaultValue);\n    } else retValue[prop.name] = prop.defaultValue;\n  })\n} else retValue = JSON.parse(retAnno.defaultValue);\nreturnBody = retValue;\n\nevent.setData({\n  returnSample: JSON.stringify(returnBody, null, 2)\n})\n"},{"ignoreError":false,"actionType":"dialog","dialog":{"type":"dialog","body":[{"type":"editor","label":"","name":"returnSample","language":"json","id":"returnSample","value":""}],"showCloseButton":true,"showErrorMsg":true,"showLoading":true,"className":"app-popover :AMISCSSWrapper","actions":[{"type":"button","actionType":"cancel","label":"取消","id":"u:7e86d008a9c7"},{"type":"button","actionType":"confirm","label":"确认","primary":true,"id":"u:35655135dd71"}],"id":"u:20bf345f1077","title":"返回参数示例","closeOnOutside":false,"closeOnEsc":false,"draggable":false}}]}},"id":"u:850c6cd1d300","editorState":"default","level":"light","block":true},{"type":"editor","id":"u:2f0a85d8140a","label":"事务组编号","name":"tranGroupId","placeholder":"相邻且相同的编号会使用同一个事务","language":"javascript","size":"sm","description":"支撑常量、变量，如t1、_par.outType"},{"type":"editor","label":"将返回数据赋值给哪个参数","name":"returnAccept","language":"javascript","size":"sm","id":"u:2287ffd80664"},{"type":"textarea","label":"备注","name":"memo","id":"u:dc0abcb09330","minRows":3,"maxRows":20},{"type":"static-json","id":"item_params","label":"参数声明","quickEdit":false,"popOver":false,"copyable":false,"name":"params","levelExpand":0},{"type":"static-json","id":"item_returnType","label":"返回值声明","quickEdit":false,"popOver":{"type":"panel","title":"查看详情","body":[{"type":"editor","label":"代码编辑器","name":"item_returnBody","id":"u:5c01af33c9c1"}],"id":"u:549fac8b8843"},"copyable":false,"name":"returnType","levelExpand":0}],"onEvent":{"submitSucc":{"actions":[{"actionType":"custom","ignoreError":false,"script":"/* 自定义JS使用说明：\n  * 1.动作执行函数doAction，可以执行所有类型的动作\n  * 2.通过上下文对象context可以获取当前组件实例，例如context.props可以获取该组件相关属性\n  * 3.事件对象event，在doAction之后执行event.stopPropagation();可以阻止后续动作执行\n*/\nif (context.props.data.bodyByForm == true) {\n  const params = context.props.data.params;\n  let newBody = {};\n  params.forEach(v => {\n    newBody[v.name] = v.defaultValue\n  })\n  let bodyJs = `return ` + JSON.stringify(newBody, (key, value) => {\n    return value === undefined ? null : value; // 将 undefined 替换为 null\n  }, 2).replaceAll('\"', '');\n  doAction({\n    actionType: 'setValue',\n    componentId: 'javaForm',\n    args: {\n      value: {\n        body: bodyJs\n      }\n    }\n  });\n  event.data.body = bodyJs;\n}\n"},{"actionType":"broadcast","args":{"eventName":"formSubmited"},"data":"${event.data}"}]}},"actions":[{"type":"submit","label":"保存","id":"u:d2d02ca51bfc","primary":true,"editorState":"default","block":true,"size":"md"}],"feat":"Insert","mode":"normal","dsType":"api","debug":false}],"asideResizor":false,"pullRefresh":{"disabled":true},"regions":["body"],"error":{"code":0},"status":0,"id":"u:e339c263ac5e","name":"page1"}