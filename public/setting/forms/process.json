{"body":[{"type":"form","title":"节点配置","body":[{"type":"group","id":"u:3dc86f418cdd","body":[{"type":"input-text","id":"u:30db4470577d","label":"加工类型","name":"text","static":true,"onEvent":{"change":{"weight":0,"actions":[]}}},{"type":"input-text","label":"key","name":"key","static":true,"onEvent":{"change":{"weight":0,"actions":[]}},"id":"u:1bace3e8b19a","visible":false},{"type":"switch","label":"是否手动工序","name":"switch","falseValue":false,"trueValue":true,"id":"u:5c1a517d0386","value":true}]},{"type":"group","id":"u:ed3c20206cc5","body":[{"type":"tree-select","id":"u:30db4470577d","label":"工序名称","name":"name","multiple":false,"source":{"url":"/api/mes/asm-standard/group/tree/data?typeCode=${key}","method":"get","requestAdaptor":"","adaptor":"let options = []\npayload.result.forEach(v => {\n    options.push({ ...v, children: v.child })\n})\nreturn {\n    status: payload.code == 1 ? 0 : 1,\n    msg: payload.message,\n    data: {\n        options: options\n    }\n}","messages":{},"dataType":"form"},"labelField":"groupName","valueField":"groupName","onEvent":{"change":{"weight":0,"actions":[{"actionType":"custom","ignoreError":false,"script":"/* 自定义JS使用说明：\n  * 1.动作执行函数doAction，可以执行所有类型的动作\n  * 2.通过上下文对象context可以获取当前组件实例，例如context.props可以获取该组件相关属性\n  * 3.事件对象event，在doAction之后执行event.stopPropagation();可以阻止后续动作执行\n*/\nlet frock = []\nlet workStepOpts = []\nconsole.log('工序值变化')\nconsole.log('event.data')\nconsole.log(event.data)\nlet p;\nlet index = 0;\nwhile (!p && index < event.data.items.length) {\n  if (event.data.items[index].child)\n    p = event.data.items[index].child.find(i => i.groupName == event.data.name);\n  index = index + 1;\n}\nconsole.log('p',p)\nif (p) {\n  Object.getOwnPropertyNames(p.frockDicMap).forEach(f => {\n    let name = f;\n    let cnt = p.frockDicMap[f]\n    console.log(name)\n    console.log(p.frockDicMap)\n    for (i = 0; i < cnt; i++) {\n      frock.push({\n        typeName: name,\n        modelCode: '',\n        modelName: ''\n      })\n    }\n  })\n  Object.getOwnPropertyNames(p.stepsDicMap).forEach(f => {\n    workStepOpts.push({\n      label: p.stepsDicMap[f],\n      value: p.stepsDicMap[f]\n    })\n  })\n  doAction({\n    actionType: 'setValue',\n    componentId: 'processForm',\n    args: {\n      value: {\n        code: p.groupCode\n      }\n    }\n  });\n}\nconsole.log('frock')\nconsole.log(frock)\nconsole.log('workStepOpts')\nconsole.log(workStepOpts)\ndoAction({\n  actionType: 'setValue',\n  componentId: 'item_frock',\n  args: {\n    value: frock\n  }\n});\ndoAction({\n  actionType: 'setValue',\n  componentId: 'processForm',\n  args: {\n    value: {\n      workStepsOpts: workStepOpts\n    }\n  }\n});\n\n"}]}},"searchable":false,"onlyLeaf":true,"enableNodePath":false,"showIcon":false,"initiallyOpen":true,"hideNodePathLabel":true},{"type":"input-text","label":"工序编号","id":"u:c402d6b58a8d","static":true,"name":"code","editorState":"default","source":"${code}","multiple":false}]},{"type":"select","id":"item_workSteps","label":"执行工步","name":"workSteps","multiple":true,"checkAll":false,"source":"${workStepsOpts}"},{"type":"select","id":"u:184d9e89d73e","label":"工作中心","name":"work_group","multiple":true,"source":{"url":"/api/mes/asm-standard/workShop/find_hierarchy_data","method":"post","requestAdaptor":"","adaptor":"return {\n    status: payload.code == 1 ? 0 : 1,\n    msg: payload.message,\n    data: {\n        options: payload.result\n    }\n}","messages":{},"data":{"modelCode":"WORKCENTER","shopTag":0,"name":" ","code":" "},"dataType":"json"},"labelField":"name","valueField":"value","checkAll":false},{"type":"group","id":"u:31a067307831","body":[{"type":"switch","label":"首件检验","id":"u:bbcfb40cfe0d","name":"isFirstCheck","value":false,"falseValue":false,"trueValue":true},{"type":"switch","label":"末件检验","id":"u:5541b4ad8bb6","name":"isFinalCheck","falseValue":false,"trueValue":true,"value":true}]},{"type":"group","body":[{"type":"select","label":"巡检频次","id":"u:bd2a44af496c","multiple":false,"name":"repeatCheckUnit","options":[{"label":"每n小时巡检一次","value":"0"},{"label":"每n件巡检一次","value":"1"},{"label":"无需巡检","value":"-1"}],"value":"0"},{"type":"input-number","label":"n=","id":"u:5d1db21c3637","keyboard":true,"step":1,"name":"repeatCheckNum","visibleOn":"${repeatCheckUnit!=-1}"}],"id":"u:459c6e143782"},{"type":"group","body":[{"type":"select","label":"点检频次","id":"u:f48191205c24","multiple":false,"name":"tpmCheckUnit","options":[{"label":"每n小时点检一次","value":"0"},{"label":"每n件点检一次","value":"1"},{"label":"无需点检","value":"-1"}],"value":"0"},{"type":"input-number","label":"n=","id":"u:3b087fa3111f","keyboard":true,"step":1,"name":"tpmCheckNum","visibleOn":"${tpmCheckUnit!=-1}"}],"id":"u:a31f03709fde"},{"type":"group","body":[{"type":"input-group","body":[{"type":"input-number","name":"machineCheckNum","id":"u:f55aa6bca438","value":0.5,"keyboard":true,"step":0.5,"precision":1},{"type":"tpl","id":"u:b3a87a358fd2","tpl":"min/分钟"}],"id":"u:1c6784097151","label":"调机时长"},{"type":"input-group","label":"后置时间","id":"u:095d6a702a05","body":[{"type":"input-number","id":"u:e1cbba7bf8ce","name":"materialWaitNum","keyboard":true,"step":0.5,"suffix":"","value":0.5,"precision":1},{"type":"tpl","tpl":"min/分钟","id":"u:8f6977e22988"}]}],"id":"u:3660f3e82aa9"},{"type":"group","body":[{"type":"input-group","label":"单站生产节拍","id":"u:ffd1366985f1","body":[{"type":"input-number","name":"productTime","id":"u:f8f6141693eb","value":500,"keyboard":true,"step":1},{"type":"select","label":"单位","name":"productTimeUnit","id":"u:81452e8058b7","options":[{"label":"s/秒","value":"s"},{"label":"min/分","value":"min"},{"label":"h/时","value":"h"}],"value":"s","multiple":false}]},{"type":"input-number","id":"u:41a50f6437c3","label":"生产","name":"productNum","keyboard":true,"step":1}],"id":"u:75a9f34527bd"},{"type":"group","id":"u:43796a72300a","body":[{"type":"select","label":"BOM单位","id":"u:ab31484c4bde","name":"bomUnit","source":{"url":"/api/mes/asm-system/bbs/v1/common/dictionaries/list","method":"post","requestAdaptor":"api.data = { \"applicationCode\": \"bbs\", \"dictionaryCategoryCode\": \"units\" }\nreturn api;","adaptor":"return {\n    status: payload.code == 1 ? 0 : 1,\n    msg: payload.message,\n    data: {\n        options: payload.data\n    }\n}","messages":{},"dataType":"json"},"multiple":false,"labelField":"text","valueField":"key"},{"type":"input-group","body":[{"type":"input-number","id":"u:52dcef47940d","value":500,"keyboard":true,"step":0.5,"name":"qualityData","suffix":""},{"type":"tpl","tpl":"h/时","inline":true,"wrapperComponent":"","id":"u:95c872c7088b"}],"id":"u:ee51410f40dc","label":"保质期"}]},{"type":"combo","label":"工装配置","name":"frock","id":"item_frock","multiple":true,"addable":false,"removable":false,"removableMode":"icon","addBtn":{"label":"新增","icon":"fa fa-plus","level":"primary","size":"sm","id":"u:efb1da2c331b"},"items":[{"type":"input-text","name":"typeName","placeholder":"文本","id":"u:bf284de8afda","readOnly":true},{"type":"select","name":"modelCode","placeholder":"选项","options":[{"label":"A","value":"a"},{"label":"B","value":"b"}],"id":"u:307a473ec8f1","multiple":false}],"strictMode":true,"syncFields":[],"value":[],"visible":false},{"type":"input-file","label":"SOP","autoUpload":true,"proxy":true,"uploadType":"fileReceptor","name":"file","id":"u:bf3d10059ae4","btnLabel":"点击上传","multiple":false,"useChunk":false,"accept":".pdf,.jpg,.png","drag":false,"receiver":{"url":"/api/mes/asm-standard/v1/file/upload","method":"post","requestAdaptor":"","adaptor":"return {\n    status: payload.code == 1 ? 0 : 500,\n    data: {\n        value: payload.result,\n        url:payload.result\n    }\n}","messages":{},"dataType":"form-data","data":{"&":"$$","appCode":"mes","filePath":"/route"}},"autoFill":{},"description":"支持pdf,jpg,png文件"}],"mode":"horizontal","feat":"Insert","name":"form1","actions":[{"type":"submit","label":"提交","primary":true,"id":"u:12347c8c7ad5"}],"dsType":"api","id":"processForm","onEvent":{"submitSucc":{"actions":[{"actionType":"broadcast","args":{"eventName":"formSubmited"},"data":"${event.data}"}]}},"data":{"workStepsOpts":[]}}],"type":"page","asideResizor":false,"pullRefresh":{"disabled":true},"regions":["body"],"error":{"code":0},"status":0,"name":"page1","id":"u:e339c263ac5e"}